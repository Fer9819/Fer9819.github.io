<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>page-d.knit</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geomática</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-spinner fa-pulse fa-3x fa-fw"></span>
     
    Portafolio
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Primer hemiciclo</li>
    <li>
      <a href="page-a.html">Semana 1</a>
    </li>
    <li>
      <a href="page-b.html">Semana 2</a>
    </li>
    <li>
      <a href="page-c.html">Semana 3</a>
    </li>
    <li>
      <a href="page-d.html">Semana 4</a>
    </li>
    <li>
      <a href="page-f.html">Semana 5</a>
    </li>
    <li>
      <a href="page-g.html">Semana 6</a>
    </li>
    <li>
      <a href="page-h.html">Semana 7</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Segundo hemiciclo</li>
    <li>
      <a href="page-i.html">Semana 9</a>
    </li>
    <li>
      <a href="page-j.html">Semana 10</a>
    </li>
    <li>
      <a href="page-k.html">Semana 11</a>
    </li>
    <li>
      <a href="page-l.html">Semana 12</a>
    </li>
    <li>
      <a href="page-m.html">Semana 13</a>
    </li>
    <li>
      <a href="page-n.html">Semana 14</a>
    </li>
    <li>
      <a href="page-o.html">Semana 15</a>
    </li>
    <li>
      <a href="page-p.html">Semana 16</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Talleres 
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="taller2.html">Taller2</a>
    </li>
    <li>
      <a href="taller4.html">Taller4</a>
    </li>
    <li>
      <a href="taller5.html">Taller5</a>
    </li>
    <li>
      <a href="taller6.html">Taller6</a>
    </li>
    <li>
      <a href="IDW.html">Interpolación IDW</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Glosario 
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="primer_hemiciclo.html">Primer Hemiciclo</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<center>
<p><img src="LOGO_OUT.png" height="75" /></p>
<p><strong>Universidad Técnica de Machala</strong></p>
<p><strong>Facultad de Ciencias Agropecuarias</strong></p>
<p><strong>Carrera de Agronomía</strong></p>
<p><strong>Geomática</strong></p>
</center>
<ol style="list-style-type: decimal">
<li><p><strong>Datos Informativos</strong></p>
<p><strong>Docente:</strong> Ing. Agr. Angel Eduardo Luna Romero</p>
<p><strong>Semana:</strong> 4</p></li>
</ol>
<pre class="r"><code>setwd(&quot;C:/Users/Eirck/Desktop/diarios/&quot;)
library(pacman)
p_load(tidyverse, sf, sp, raster, rgdal, glue, RColorBrewer)</code></pre>
<p>#cargar una imagen(raster)</p>
<pre class="r"><code>img&lt;- raster(&quot;CHIRPS/chira_1981.01.tif&quot;)
plot(img)</code></pre>
<p><img src="page-d_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>obj&lt;- paste0(&quot;quinto&quot;,LETTERS[1:2], rep(&quot;alumno&quot;,12), 1:12)
view(obj)
head(obj)</code></pre>
<pre><code>## [1] &quot;quintoAalumno1&quot; &quot;quintoBalumno2&quot; &quot;quintoAalumno3&quot; &quot;quintoBalumno4&quot; &quot;quintoAalumno5&quot; &quot;quintoBalumno6&quot;</code></pre>
<pre class="r"><code>class(obj)</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>#$ nos ayuda cuando lo usemos en otro programa no modifique el mobre del archivo al final</p>
<pre class="r"><code>img&lt;- list.files(&quot;./CHIRPS/&quot;,
                 full.names = TRUE , pattern = &quot;.tif$&quot;) </code></pre>
<pre class="r"><code>prm&lt;- c(img[1], img[13])</code></pre>
<pre class="r"><code>prm&lt;- lapply(prm, FUN = raster) %&gt;% stack()
plot(prm)</code></pre>
<p><img src="page-d_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Debido a que el valor NA es un marcador de posición y no un valor numérico real, no se puede incluir en los cálculos. Entonces, de alguna manera debe eliminarse de los cálculos para obtener un valor significativo. Si incluye el valor NA en un cálculo, dará como resultado un valor NA.</p>
<pre class="r"><code>prm&lt;- mean(prm, na.rm=T)</code></pre>
<p>st_readsigue las convenciones de la base R, similar a cómo lee datos tabulares en data.frames. Esto significa que los datos de caracteres se leen, por defecto como factors.</p>
<pre class="r"><code>bsn&lt;- st_read(&quot;SHP/CUENCAS.shp&quot;) #opcion 1 </code></pre>
<pre><code>## Reading layer `CUENCAS&#39; from data source `C:\Users\Eirck\Desktop\diarios\Fer9819.github.io\SHP\CUENCAS.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 3 features and 4 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -80.45177 ymin: -5.011824 xmax: -77.79864 ymax: -2.001942
## Geodetic CRS:  WGS 84</code></pre>
<pre class="r"><code>plot(bsn)</code></pre>
<p><img src="page-d_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>#
class(bsn)</code></pre>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<pre class="r"><code>#
head(bsn)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">NOMBRE_CUE</th>
<th align="left">CODIGO_SIS</th>
<th align="left">NOMBRE_SIS</th>
<th align="left">COD_CUE</th>
<th align="left">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">70 R&lt;U+FFFD&gt;o Chira</td>
<td align="left">22</td>
<td align="left">Catamayo-Chira</td>
<td align="left">210</td>
<td align="left">POLYGON ((-79.33278 -4.5442…</td>
</tr>
<tr class="even">
<td align="left">78 R&lt;U+FFFD&gt;o Santiago</td>
<td align="left">30</td>
<td align="left">Santiago</td>
<td align="left">280</td>
<td align="left">POLYGON ((-78.6028 -4.24260…</td>
</tr>
<tr class="odd">
<td align="left">79 R&lt;U+FFFD&gt;o Mayo</td>
<td align="left">31</td>
<td align="left">Chinchipe</td>
<td align="left">300</td>
<td align="left">POLYGON ((-78.90952 -4.8406…</td>
</tr>
</tbody>
</table>
<pre class="r"><code>cnc&lt;- shapefile(&quot;SHP/CUENCAS.shp&quot;) #opcion 2
plot(cnc)</code></pre>
<p><img src="page-d_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>head(cnc)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">NOMBRE_CUE</th>
<th align="left">CODIGO_SIS</th>
<th align="left">NOMBRE_SIS</th>
<th align="left">COD_CUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="left">70 Rï¿½o Chira</td>
<td align="left">22</td>
<td align="left">Catamayo-Chira</td>
<td align="left">210</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">78 Rï¿½o Santiago</td>
<td align="left">30</td>
<td align="left">Santiago</td>
<td align="left">280</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">79 Rï¿½o Mayo</td>
<td align="left">31</td>
<td align="left">Chinchipe</td>
<td align="left">300</td>
</tr>
</tbody>
</table>
<div id="seccion-2" class="section level1">
<h1>seccion 2 —————————————————————</h1>
<p>Cambiar simbolo, letra en cualquier palabra</p>
<pre class="r"><code>aux&lt;- &quot;compajero&quot;
aux1&lt;- str_replace(aux, pattern = &quot;j&quot;, replacement =&quot;nh&quot;)
head(aux1)</code></pre>
<pre><code>## [1] &quot;companhero&quot;</code></pre>
<pre class="r"><code>cnc@data$id&lt;- 1:nrow(cnc@data)
cnc_r &lt;- raster::rasterize(cnc,prm, field=&quot;id&quot;)
plot(cnc_r)</code></pre>
<p><img src="page-d_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>#Estadistica zonal
znl&lt;- raster::zonal(prm, cnc_r, fun= mean)

tbl&lt;- data.frame(meses=month.abb, mes=1:12)
mnt&lt;- &quot;01.tif&quot;</code></pre>
<pre class="r"><code>rsl&lt;- znl %&gt;% 
  as_tibble() %&gt;%
  inner_join(., cnc@data, by= c(&quot;zone&quot;=&quot;id&quot;)) %&gt;%
  mutate(NOMBRE_CUE= str_replace(NOMBRE_CUE,
                                 pattern = &quot;�&quot;,replacement = &quot;i&quot;)) %&gt;% 
  dplyr::select(sistema=NOMBRE_SIS, zona=zone, PP= value) %&gt;% 
  mutate(PP=as.numeric(PP) %&gt;%  round(., digits = 2),mes=str_replace(mnt, pattern = &quot;.tif&quot;, replacement = &quot;&quot;) %&gt;% as.numeric()) %&gt;% 
inner_join(.,tbl, by=c(&quot;mes&quot;)) %&gt;% 
  dplyr::select(sistema, zona, meses, PP)</code></pre>
</div>
<div id="funcion-para-estadistica-zonal" class="section level1">
<h1>Funcion para estadistica zonal ——————————————</h1>
<pre class="r"><code>mipromedio &lt;- function(mnt){
  print(mnt)
  mnt &lt;- paste0(mnt, &quot;.tif&quot;)
  fls &lt;- grep(mnt,img, value = T)
  stk &lt;- stack(fls)
  avg &lt;- mean(stk, na.rm= T)
  writeRaster(avg,glue(&quot;promedio_{mnt}&quot;), overwrite= T)
  # rasterizar los shapefile
  cnc@data$gid&lt;- 1:nrow(cnc@data)
  lgr &lt;- raster::rasterize(cnc, avg, field = &quot;gid&quot;)
  znl &lt;- raster::zonal(avg,lgr, fun = mean)
  #Ajuste de la tabla de resultados
  mnt &lt;- str_replace(mnt, pattern =&quot;.tif&quot;, replacement = &quot;&quot; )
  rsl&lt;- znl %&gt;% 
    as_tibble() %&gt;%
    inner_join(., cnc@data, by= c(&quot;zone&quot;=&quot;gid&quot;)) %&gt;%
    mutate(NOMBRE_CUE= str_replace(NOMBRE_CUE,
                                   pattern = &quot;�&quot;,replacement = &quot;i&quot;)) %&gt;% 
    dplyr::select(sistema=NOMBRE_SIS, zona=zone, PP= value) %&gt;% 
    mutate(PP=as.numeric(PP) %&gt;%  round(., digits = 2),mes= mnt %&gt;% as.numeric()) %&gt;% 
    
    inner_join(.,tbl, by=c(&quot;mes&quot;)) %&gt;% 
    dplyr::select(sistema, zona, meses, PP)
  write_csv(rsl, paste0(&quot;promedio_&quot;,mnt,&quot;.csv&quot;))
  print(&quot;fin&quot;)
  return(rsl)
}  </code></pre>
<pre class="r"><code>avg &lt;- map(.x =c(paste0(&quot;0&quot;,1:9), 10:12), .f= mipromedio)</code></pre>
<pre><code>## [1] &quot;01&quot;
## [1] &quot;fin&quot;
## [1] &quot;02&quot;
## [1] &quot;fin&quot;
## [1] &quot;03&quot;
## [1] &quot;fin&quot;
## [1] &quot;04&quot;
## [1] &quot;fin&quot;
## [1] &quot;05&quot;
## [1] &quot;fin&quot;
## [1] &quot;06&quot;
## [1] &quot;fin&quot;
## [1] &quot;07&quot;
## [1] &quot;fin&quot;
## [1] &quot;08&quot;
## [1] &quot;fin&quot;
## [1] &quot;09&quot;
## [1] &quot;fin&quot;
## [1] &quot;10&quot;
## [1] &quot;fin&quot;
## [1] &quot;11&quot;
## [1] &quot;fin&quot;
## [1] &quot;12&quot;
## [1] &quot;fin&quot;</code></pre>
</div>
<div id="extraer-valores-de-imagen-raster--" class="section level1">
<h1>Extraer valores de imagen raster —————————————-</h1>
<pre class="r"><code>rst &lt;- list.files(&quot;.&quot;, full.names = T, pattern = &quot;.tif$&quot;) %&gt;% stack()
vls &lt;- rasterToPoints(rst,xy=T) %&gt;%
  as.tibble() %&gt;% 
  gather(var, valor, -x, -y) %&gt;% 
  mutate(mes=parse_number(var)) %&gt;% 
  inner_join(.,tbl, by = c(&quot;mes&quot;)) %&gt;% 
  dplyr::select(x,y,meses,valor)</code></pre>
</div>
<div id="graficar-los-valores-promedios" class="section level1">
<h1>Graficar los valores promedios ——————————————</h1>
<pre class="r"><code>vls$meses &lt;- factor(vls$meses, levels = unique(vls$meses))

ggplot(vls)+
  geom_tile(aes(x=x,y=y, fill= valor))+
  facet_wrap(~meses)</code></pre>
<p><img src="page-d_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
